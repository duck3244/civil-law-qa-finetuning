graph TB
    %% User Interface Layer
    subgraph UI ["üñ•Ô∏è User Interface Layer"]
        CLI["Command Line Interface<br/>‚Ä¢ Training mode<br/>‚Ä¢ Inference mode<br/>‚Ä¢ Test mode<br/>‚Ä¢ Interactive mode"]
    end

    %% Application Layer
    subgraph APP ["üöÄ Application Layer"]
        MAIN["Main Controller<br/>‚Ä¢ Workflow orchestration<br/>‚Ä¢ Mode selection<br/>‚Ä¢ Error handling<br/>‚Ä¢ Usage examples"]
    end

    %% Business Logic Layer
    subgraph BL ["‚öôÔ∏è Business Logic Layer"]
        DL["Data Loader<br/>‚Ä¢ CSV file loading<br/>‚Ä¢ Data validation<br/>‚Ä¢ Statistics generation<br/>‚Ä¢ Category filtering"]

        DF["Data Formatter<br/>‚Ä¢ Format conversion<br/>‚Ä¢ System prompt generation<br/>‚Ä¢ Data splitting<br/>‚Ä¢ Validation"]

        MM["Model Manager<br/>‚Ä¢ Model loading<br/>‚Ä¢ LoRA configuration<br/>‚Ä¢ Memory optimization<br/>‚Ä¢ Model serialization"]

        TM["Trainer Manager<br/>‚Ä¢ Training configuration<br/>‚Ä¢ SFT training<br/>‚Ä¢ Preset management<br/>‚Ä¢ Progress tracking"]

        IE["Inference Engine<br/>‚Ä¢ Answer generation<br/>‚Ä¢ Interactive chat<br/>‚Ä¢ Performance testing<br/>‚Ä¢ Batch processing"]
    end

    %% Data Layer
    subgraph DATA ["üíæ Data Layer"]
        CSV["CSV Dataset<br/>civil_law_qa_dataset.csv<br/>‚Ä¢ Questions & Answers<br/>‚Ä¢ Categories<br/>‚Ä¢ Difficulty levels"]

        JSON["Configuration Files<br/>‚Ä¢ Training configs<br/>‚Ä¢ Model metadata<br/>‚Ä¢ Test results<br/>‚Ä¢ Statistics"]

        MODEL["Model Artifacts<br/>‚Ä¢ LoRA adapters<br/>‚Ä¢ Tokenizer files<br/>‚Ä¢ Training checkpoints"]
    end

    %% External Dependencies
    subgraph EXT ["üì¶ External Libraries"]
        HF["ü§ó Hugging Face<br/>‚Ä¢ transformers<br/>‚Ä¢ datasets<br/>‚Ä¢ trl SFTTrainer<br/>‚Ä¢ peft LoRA"]

        TORCH["üî• PyTorch<br/>‚Ä¢ torch<br/>‚Ä¢ CUDA support<br/>‚Ä¢ Memory management"]

        UTILS["üõ†Ô∏è Utilities<br/>‚Ä¢ pandas<br/>‚Ä¢ numpy<br/>‚Ä¢ json<br/>‚Ä¢ argparse"]
    end

    %% Connections - User Interface
    CLI --> MAIN

    %% Connections - Application to Business Logic
    MAIN --> DL
    MAIN --> DF
    MAIN --> MM
    MAIN --> TM
    MAIN --> IE

    %% Connections - Business Logic Internal
    DL --> DF
    DF --> TM
    MM --> TM
    TM --> IE
    MM --> IE

    %% Connections - Data Layer
    DL -.-> CSV
    TM -.-> JSON
    IE -.-> JSON
    MM -.-> MODEL
    TM -.-> MODEL

    %% Connections - External Dependencies
    DL --> UTILS
    DF --> HF
    MM --> HF
    MM --> TORCH
    TM --> HF
    IE --> HF
    IE --> TORCH

    %% Styling
    classDef uiLayer fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef appLayer fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef businessLayer fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef dataLayer fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef externalLayer fill:#fce4ec,stroke:#c2185b,stroke-width:2px

    class CLI uiLayer
    class MAIN appLayer
    class DL,DF,MM,TM,IE businessLayer
    class CSV,JSON,MODEL dataLayer
    class HF,TORCH,UTILS externalLayer
